<nb-card>
    <nb-card-header>Solicitudes de nuevo proyecto</nb-card-header>
    <nb-card-body>
        <div class="table-responsive">
            <ng2-smart-table (custom)="onAction($event)" [settings]="settings" [source]="data$ | async">
            </ng2-smart-table>
        </div>
    </nb-card-body>
</nb-card>

<app-modal [ID]="modal" [title]="'Solicitud de proyecto'" [size]="'lg'">
    <div content>
        <div class="row">
            <div class="col-12">

                <!-- General data of the request -->
                <div class="row">
                    <div class="col-12 col-lg-6 form-group">
                        <p class="font-weight-bold text-info mb-0">General</p>
                        <hr>
                        <p *ngIf="requestSelected.requestCode" class="d-flex w-100"> <span
                                class="pl-0 font-weight-bold col-5">N° de la solicitud:</span>
                            {{ requestSelected.requestCode }} </p>
                        <p *ngIf="requestSelected.name" class="d-flex w-100"> <span
                                class="pl-0 font-weight-bold col-5">Nombre:</span>
                            {{ requestSelected.name }} </p>
                        <p *ngIf="requestSelected.email" class="d-flex w-100"> <span
                                class="pl-0 font-weight-bold col-5">Correo
                                electrónico:</span>
                            {{ requestSelected.email }} </p>

                        <p *ngIf="requestSelected.email" class="d-flex w-100"> <span
                                class="pl-0 font-weight-bold col-5">Fecha
                                de la solicitud:</span>
                            {{ requestSelected.createdAt | date:'dd/MM/yyyy' }} </p>
                    </div>
                </div>
                <!-- Info Sponsor -->
                <div *ngIf="requestSelected.type === type.SPONSOR.ORIGINAL">
                    <p *ngIf="requestSelected.rif" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">RIF:</span> J-{{ requestSelected.rif }} </p>
                    <p class="d-flex w-100"><span class="pl-0 font-weight-bold col-5">Tipo de empresa:</span>
                        <span *ngIf="requestSelected.companyType === '1'">Fabrica</span>
                        <span *ngIf="requestSelected.companyType === '2'">Tienda</span>
                        <span *ngIf="requestSelected.companyType === '3'">Negocio personal</span>
                        <span *ngIf="requestSelected.companyType === '4'">Otro</span>
                    </p>
                    <p *ngIf="requestSelected.companyOtherType" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Otro tipo:</span>{{ requestSelected.companyOtherType }}
                    </p>
                    <p *ngIf="requestSelected.companyPhone" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Teĺéfono de la
                            empresa:</span>{{ requestSelected.companyPhone }}
                    </p>
                    <p class="font-weight-bold text-info mb-0">Datos de dirección</p>
                    <hr>
                    <p *ngIf="requestSelected.address" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Dirección:</span>{{ requestSelected.address }}</p>
                    <p *ngIf="requestSelected.addressState.name" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Estado:</span>{{ requestSelected.addressState.name }}
                    </p>
                    <p *ngIf="requestSelected.addressMunicipality.name" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Municipio:</span>
                        {{ requestSelected.addressMunicipality.name }}</p>
                    <p *ngIf="requestSelected.addressCity" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Ciudad:</span>
                        {{ requestSelected.addressCity }}</p>
                    <p *ngIf="requestSelected.addressStreet" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Calle:</span>
                        {{ requestSelected.addressStreet }}</p>

                    <p class="font-weight-bold text-info mb-0">Datos de las persona de contacto</p>
                    <hr>

                    <p *ngIf="requestSelected.contactFirstName" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Nombre de la persona de contacto:</span>
                        {{ requestSelected.contactFirstName }}</p>
                    <p *ngIf="requestSelected.contactLastName" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Apellido de la persona de contacto:</span>
                        {{ requestSelected.contactLastName }}</p>
                    <p *ngIf="requestSelected.contactPhone" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Teléfono de la persona de contacto:</span>
                        {{ requestSelected.contactPhone }}</p>

                    <p *ngIf="requestSelected.createdAt" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Fecha de la solicitud:</span>
                        {{ requestSelected.createdAt | date:'dd/MM/yyyy' }}</p>
                </div>

                <!-- Info coordinator -->
                <div *ngIf="requestSelected.type === type.COORDINATOR.ORIGINAL">

                    <p *ngIf="requestSelected.phone" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Teléfono:</span>{{ requestSelected.phone }}</p>
                    <p *ngIf="requestSelected.homePhone" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Teléfono de
                            habitación:</span>{{ requestSelected.homePhone }}</p>

                    <p *ngIf="requestSelected.cardId" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Documento de identidad:</span>
                        <span *ngIf="requestSelected.cardType === '1'">V</span>
                        <span *ngIf="requestSelected.cardType === '3'">E</span>
                        <span *ngIf="requestSelected.cardType === '2'">J</span>-{{ requestSelected.cardId }} </p>
                    <p *ngIf="requestSelected.birthdate" class="d-flex"> <span class="pl-0 font-weight-bold col-5">Fecha
                            de nacimiento:</span>
                        {{ requestSelected.birthdate | date:'dd/MM/yyyy' }}</p>

                    <p *ngIf="requestSelected.gender" class="d-flex w-100"> <span
                            class="pl-0 font-weight-bold col-5">Genero:</span> <span
                            *ngIf="requestSelected.gender === '1'">Femenino</span>
                        <span *ngIf="requestSelected.gender === '2'">Masculino</span>
                    </p>
                    <p *ngIf="requestSelected.addressState.name" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Estado:</span>
                        {{ requestSelected.addressState.name }} </p>
                    <p *ngIf="requestSelected.addressMunicipality.name" class="d-flex w-100">
                        <span class="pl-0 font-weight-bold col-5">Municipio:</span>
                        {{ requestSelected.addressMunicipality.name }} </p>
                    <p class="d-flex w-100" *ngIf="requestSelected.addressCity"><span
                            class="pl-0 font-weight-bold col-5">Ciudad:</span>{{ requestSelected.addressCity }} </p>
                    <p class="d-flex w-100" *ngIf="requestSelected.addressStreet"><span
                            class="pl-0 font-weight-bold col-5">Calle / Carrera:</span>
                        {{ requestSelected.addressStreet }} </p>
                    <p class="d-flex w-100" *ngIf="requestSelected.addressHome"><span
                            class="pl-0 font-weight-bold col-5">Casa / Edificio:</span>{{ requestSelected.addressHome }}
                    </p>
                    <p class="d-flex w-100" *ngIf="requestSelected.profession"><span
                            class="pl-0 font-weight-bold col-5">Profesión:</span>{{ requestSelected.profession }}</p>
                    <p class="d-flex w-100" *ngIf="requestSelected.isReferred"><span
                            class="pl-0 font-weight-bold col-5">Nombre de la persona referida:</span>
                        {{ requestSelected.referredName }} </p>
                    <hr>
                </div>

                <!-- Info school -->
                <div *ngIf="requestSelected.type === type.SCHOOL.ORIGINAL">
                    <div class="row">
                        <!-- Normal data -->
                        <div class="col-12 col-lg-6 form-group">

                            <div>
                                <p class="font-weight-bold text-info mb-0">Datos de la escuela</p>
                                <hr>
                                <div class="row">
                                    <div class="col-12">
                                        <p class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Teléfono:</span><span>{{ requestSelected.phone }}</span>
                                        </p>
                                        <p class="d-flex w-100"><span class="pl-0 font-weight-bold col-5">Código del
                                                plantel:</span><span>{{ requestSelected.code }}</span></p>
                                        <p *ngIf="requestSelected.schoolType" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Tipo de
                                                escuela:</span>
                                            <span *ngIf="requestSelected.schoolType === '3'">Municipal</span>

                                            <span *ngIf="requestSelected.schoolType === '2'">Estadal</span>
                                            <span *ngIf="requestSelected.schoolType === '1'">Nacional</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="col-12 col-lg-6 form-group">

                            <div>
                                <p class="font-weight-bold text-info mb-0">Datos de dirección</p>
                                <hr>
                                <div class="row">
                                    <div class="col-12">
                                        <p class="d-flex w-100"><span class="pl-0 col-5 font-weight-bold">Estado:</span>
                                            <span>{{ requestSelected.addressState.name }}</span> </p>
                                        <p class="d-flex w-100"><span
                                                class="pl-0 col-5 font-weight-bold">Municipio:</span>
                                            <span>{{ requestSelected.addressMunicipality.name }}</span></p>
                                        <p *ngIf="requestSelected.address" class="d-flex w-100"><span
                                                class="pl-0 col-5 font-weight-bold">Dirección:</span>
                                            <span>{{ requestSelected.address }}</span></p>
                                        <p class="d-flex w-100"><span class="pl-0 col-5 font-weight-bold">Ciudad:</span>
                                            <span>{{ requestSelected.addressCity }}</span></p>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Principal data -->
                        <div class="col-12 col-lg-6 form-group">

                            <div>
                                <p class="font-weight-bold text-info mb-0">Datos del director</p>
                                <hr>
                                <div class="row">
                                    <div class="col-12">
                                        <p class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Nombre:</span><span>{{ requestSelected.principalFirstName }}</span>
                                        </p>
                                        <p class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Apellido:</span><span>{{ requestSelected.principalLastName }}</span>
                                        </p>
                                        <p class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Correo:</span><span>{{ requestSelected.principalEmail }}</span>
                                        </p>
                                        <p class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Teléfono:</span><span>{{ requestSelected.principalPhone }}</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sub Principal Data -->
                        <div class="col-12 col-lg-6 form-group"
                            *ngIf="requestSelected.subPrincipalFirstName || requestSelected.subPrincipalLastName || requestSelected.subPrincipalEmail || requestSelected.subPrincipalPhone">

                            <div>
                                <p class="font-weight-bold text-info mb-0">Datos del subdirector</p>
                                <hr>
                                <div class="row">
                                    <div class="col-12">
                                        <p *ngIf="requestSelected.subPrincipalFirstName" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Nombre:</span><span>{{ requestSelected.subPrincipalFirstName }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.subPrincipalLastName" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Apellido:</span><span>{{ requestSelected.subPrincipalLastName }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.subPrincipalEmail" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Correo:</span><span>{{ requestSelected.subPrincipalEmail }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.subPrincipalPhone" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Teléfono:</span><span>{{ requestSelected.subPrincipalPhone }}</span>
                                        </p>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Additional data -->
                        <div class="col-12 col-lg-6 form-group"
                            *ngIf="requestSelected.schoolShift || requestSelected.nTeachers || requestSelected.nAdministrativeStaff || requestSelected.nLaborStaff || requestSelected.nStudents || requestSelected.nGrades || requestSelected.nSections">

                            <div>
                                <p class="font-weight-bold text-info mb-0">Datos adicionales</p>
                                <hr>
                                <div class="row">
                                    <div class="col-12">
                                        <p *ngIf="requestSelected.nTeachers" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Cantidad de
                                                docentes:</span><span>{{ requestSelected.nTeachers }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.nAdministrativeStaff" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Cantidad de personal
                                                administrativo:</span><span>{{ requestSelected.nAdministrativeStaff }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.nLaborStaff" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Cantidad de personal
                                                obrero:</span><span>{{ requestSelected.nLaborStaff }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.nStudents" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Cantidad de
                                                estudiantes:</span><span>{{ requestSelected.nStudents }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.nGrades" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Cantidad de
                                                grados:</span><span>{{ requestSelected.nGrades }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.nSections" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Cantidad de
                                                secciones:</span><span>{{ requestSelected.nSections }}</span>
                                        </p>
                                        <p *ngIf="requestSelected.schoolShift" class="d-flex w-100"><span
                                                class="pl-0 font-weight-bold col-5">Turno de
                                                clases:</span>
                                            <span *ngIf="requestSelected.schoolShift === '1'">Mañana</span>
                                            <span *ngIf="requestSelected.schoolShift === '2'">Tarde</span>
                                            <span *ngIf="requestSelected.schoolShift === '3'">Ambos</span>
                                        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div *ngIf="confirmAction">
                    <label class="label"> Acciones para la solicitud</label>
                    <select [(ngModel)]="statusSelected" (change)="statusSelected = $event.target.value" class="form-control form-group">
                        <option value="2">Aceptar</option>
                        <option value="3">Rechazar</option>
                    </select>
                </div>

                <div *ngIf="!confirmAction">
                    <nb-alert status="info">Confirmar acción, al aprobar o rechazar esta solicitud no se podrá cambiar de
                        estatus.</nb-alert>
                </div>

                <div class="w-100 text-right justify-content-end">

                    <button class="col-12 col-md-auto" nbButton *ngIf="confirmAction" status="primary"
                        (click)="confirmAction=false">Proceder</button>

                    <div class="row justify-content-end">

                        <div class="col-6 col-md-auto">
                            <button (click)="onApprovedRequest()" nbButton fullWidth *ngIf="!confirmAction" status="danger">Confirmar</button>
                        </div>
                        <div class="col-6 col-md-auto">
                            <button nbButton outline fullWidth *ngIf="!confirmAction" status="basic"
                                (click)="confirmAction=true">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</app-modal>